[%# 3.6.4PLRC@aviary.pl %]
[%# The contents of this file are subject to the Mozilla Public
  # License Version 1.1 (the "License"); you may not use this file
  # except in compliance with the License. You may obtain a copy of
  # the License at http://www.mozilla.org/MPL/
  #
  # Software distributed under the License is distributed on an "AS
  # IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
  # implied. See the License for the specific language governing
  # rights and limitations under the License.
  #
  # The Original Code is the Bugzilla Bug Tracking System.
  #
  # The Initial Developer of the Original Code is Netscape Communications
  # Corporation. Portions created by Netscape are
  # Copyright (C) 1998 Netscape Communications Corporation. All
  # Rights Reserved.
  #
  # Contributor(s): Myk Melez <myk@mozilla.org>
  #
  # Translated by Zespół Aviary.pl <team@aviary.pl>
  #%]

[% PROCESS global/variables.none.tmpl %]

[% USE Bugzilla %]
[% cgi = Bugzilla.cgi %]

[% PROCESS global/header.html.tmpl
  title="Kolejka próśb"
  style = "
    table.requests th { text-align: left; }
    table#filtering th { text-align: right; }
  "
  onload="var f = document.request_form; selectProduct(f.product, f.component, null, null, 'Any');"
  javascript_urls=["js/productform.js"]
%]

<script type="text/javascript">
  var useclassification = false; // No classification level in use
  var first_load = true; // Is this the first time we load the page?
  var last_sel = []; // Caches last selection
  var cpts = new Array();
  [% n = 1 %]
  [% IF Param('useclassification') %]
    [% FOREACH clas = user.get_selectable_classifications %]
      [% FOREACH prod = user.get_selectable_products(clas.id) %]
        [%+ PROCESS js_comp %]
      [% END %]
    [% END %]
  [% ELSE %]
    [% FOREACH prod = user.get_selectable_products %]
      [%+ PROCESS js_comp %]
    [% END %]
  [% END %]
</script>

[% BLOCK js_comp %]
  cpts['[% n %]'] = [
    [%- FOREACH comp = prod.components %]'[% comp.name FILTER js %]'[% ", " UNLESS loop.last %] [%- END -%]];
  [% n = n+1 %]
[% END %]

<p>
Jeśli użytkownik jest zalogowany, domyślnie wyświetlone są tylko jego prośby
lub prośby do niego adresowane. Kryteria wyświetlania można zmienić w formularzu poniżej.
Gdy użytkownik jest wylogowany, domyślnie wyświetlane są wszystkie oczekujące prośby,
które nie są ograniczone do grupy.
</p>

<form id="request_form" name="request_form" action="request.cgi" method="get">
  <input type="hidden" name="action" value="queue">

  <table id="filtering">
    <tr>
      <th>Zgłaszający:</th>
      <td><input type="text" name="requester" value="[% cgi.param('requester') FILTER html %]" size="20" 
           title="Adres e-mail zgłaszającego prośbę"></td>
      <th>Produkt:</th>
      <td>
        <select name="product" onchange="selectProduct(this, this.form.component, null, null, 'Any');">
          <option value="">Dowolny</option>
          [% IF Param('useclassification') %]
            [% FOREACH c = user.get_selectable_classifications %]
              <optgroup label="[% c.name FILTER html %]">
                [% FOREACH p = user.get_selectable_products(c.id) %]
                  <option value="[% p.name FILTER html %]"
                    [% " selected" IF cgi.param('product') == p.name %]>
                    [% p.name FILTER html %]
                  </option>
                [% END %]
              </optgroup>
            [% END %]
          [% ELSE %]
            [% FOREACH p = user.get_selectable_products %]
              <option value="[% p.name FILTER html %]"
                [% " selected" IF cgi.param('product') == p.name %]>
                [% p.name FILTER html %]
              </option>
            [% END %]
          [% END %]
        </select>
      </td>
      <th>Flaga:</th>
      <td>
        [% PROCESS "global/select-menu.html.tmpl"
                    name="type"
                    options=types
                    default=cgi.param('type') %]
      </td>

      [%# We could let people see a "queue" of non-pending requests. %]
      <!--
      <th>Status:</th>
      <td>
        [%# PROCESS "global/select-menu.html.tmpl"
                    name="status"
                    options=["wszystkie", "?", "+-", "+", "-"]
                    default=cgi.param('status') %]
      </td>
      -->

    </tr>
    <tr>
      <th>Adresat:</th>
      <td><input type="text" name="requestee" value="[% cgi.param('requestee') FILTER html %]" size="20" 
           title="Adres e-mail adresata prośby lub „–” (pauza) dla próśb bez adresata"></td>
      <th>Komponent:</th>
      <td>
        <select name="component">
          <option value="">Dowolny</option>
          [% FOREACH comp = components %]
            <option value="[% comp FILTER html %]" [% "selected" IF cgi.param('component') == comp %]>
              [% comp FILTER html %]</option>
          [% END %]
        </select>
      </td>
      <th>Grupowanie:</th>
      <td>
        [% groups = {
            "Zgłaszający" => 'requester' ,
            "Adresat prośby" => 'requestee',
            "Flaga" => 'type' ,
            "Produkt/Komponent" => 'category'
          } %]
        [% PROCESS "global/select-menu.html.tmpl" name="group" options=groups default=cgi.param('group') %]
      </td>
      <td><input type="submit" id="filter" value="Filtruj"></td>
    </tr>
  </table>

</form>

[% column_headers = {
      "type"       => "Flaga" ,
      "status"     => "Status" ,
      "bug"        => "$terms.Blad" ,
      "attachment" => "Załącznik" ,
      "requester"  => "Zgłaszający" ,
      "requestee"  => "Adresat prośby" ,
      "created"    => "Utworzono" ,
      "category"   => "Produkt/Komponent"    } %]

[% DEFAULT display_columns = ["requester", "requestee", "type", "bug", "attachment", "created"]
           group_field     = "Adresat prośby"
           group_value     = ""
%]

[% IF debug %]
  <p>[% query FILTER html %]</p>
[% END %]

[% IF requests.size == 0 %]
  <p>
    Brak próśb.
  </p>
[% ELSE %]
  [% FOREACH request = requests %]
    [% IF request.$group_field != group_value || loop.first %]
      [% group_value = request.$group_field %]
      [% PROCESS display_buglist UNLESS loop.first %]
      [% PROCESS start_new_table %]
    [% END %]
    [% buglist.${request.bug_id} = 1 %]
    <tr>
      [% FOREACH column = display_columns %]
        [% NEXT IF column == group_field || excluded_columns.contains(column) %]
        <td>[% PROCESS "display_$column" %]</td>
      [% END %]
    </tr>
  [% END %]
  [% PROCESS display_buglist %]
[% END %]

[% PROCESS global/footer.html.tmpl %]

[% BLOCK start_new_table %]
  [% buglist = {} %]

  <h3>[% column_headers.$group_field %]: 
    [%+ (request.$group_field || "Brak") FILTER email FILTER html %]</h3>
  <table class="requests" cellspacing="0" cellpadding="4" border="1">
    <tr>
      [% FOREACH column = display_columns %]
        [% NEXT IF column == group_field || excluded_columns.contains(column) %]
        <th>[% column_headers.$column %]</th>
      [% END %]
    </tr>
[% END %]

[% BLOCK display_type %]
  [% request.type FILTER html %]
[% END %]

[% BLOCK display_status %]
  [% request.status %]
[% END %]

[% BLOCK display_bug %]
  <a href="show_bug.cgi?id=[% request.bug_id %]">
    [% request.bug_id %]: [%+ request.bug_summary FILTER html %]</a>
[% END %]

[% BLOCK display_attachment %]
  [% IF request.attach_id %]
    <a href="attachment.cgi?id=[% request.attach_id %]&amp;action=edit">
      [% request.attach_id %]: [%+ request.attach_summary FILTER html %]</a>
  [% ELSE %]
    N/D
  [% END %]
[% END %]

[% BLOCK display_requestee %]
  [% request.requestee FILTER email FILTER html %]
[% END %]

[% BLOCK display_requester %]
  [% request.requester FILTER email FILTER html %]
[% END %]

[% BLOCK display_created %]
  [% request.created FILTER time %]
[% END %]

[% BLOCK display_buglist %]
  </table>
  [% NEXT UNLESS buglist.keys.size %]
  <a href="buglist.cgi?bug_id=
           [%- buglist.keys.nsort.join(",") FILTER html %]">(wyświetl jako listę 
  [%+ terms.bledow %])</a>
[% END %]
