<?xml version="1.0"?>
<!-- This Source Code Form is subject to the terms of the Mozilla Public
     License, v. 2.0. If a copy of the MPL was not distributed with this
     file, You can obtain one at http://mozilla.org/MPL/2.0/.

     This Source Code Form is "Incompatible With Secondary Licenses", as
     defined by the Mozilla Public License, v. 2.0.
-->
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
                      "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd" [
    <!ENTITY % myents SYSTEM "bugzilla.ent">
    %myents;
]>

<appendix id="troubleshooting">
<title>Najczęstsze problemy</title>

  <para>W rozdziale tym przedstawiono proponowane rozwiązania najczęstszych problemów mogących
  wystąpić podczas instalacji Bugzilli. Jeśli żaden z nagłówków nie opisuje twojego problemu, 
  zapoznaj się z ogólną poradą.
  </para>
    
  <section id="general-advice">
  <title>Ogólna porada</title>
    <para>Skrypt <filename>checksetup.pl</filename>, gdy nie może prawidłowo
    zakończyć swojej pracy, zwykle wyświetla komunikaty błędów opisujące napotkane problemy
    podczas instalacji i sugerujące ich rozwiązanie. Jeśli jednak są one niezrozumiałe, to aby
    uzyskać pomoc, warto opublikować je na liście dyskusyjnej <ulink url="news://news.mozilla.org/mozilla.support.bugzilla">mozilla.support.bugzilla</ulink>
    </para>

    <para>Jeśli proces
    <xref linkend="installation"/> (Instalacji) i
    <xref linkend="configuration"/> (Konfiguracji) został zakończony, a pomimo tego
    wywołanie adresu URL Bugzilli kończy się błędem, to pierwszą rzeczą, na którą warto
    zwrócić uwagę, to zawartość logów używanego serwera www.
    Apache zwykle zapisuje je w lokalizacji
    <filename>/etc/logs/httpd/error_log</filename>. Być może zawarte tam wpisy błędów
    pozwolą na szybkie zdiagnozowanie problemu i naprawienie instalacji. W przeciwnym przypadku
    proszę zapoznać się z poniższą listą najczęściej występujących problemów. Ostatecznie można 
    poprosić o pomoc na liście dyskusyjnej.
    </para>

    <para>
      Bugzilla posiada wbudowany mechanizm logowania błędów mogących wystąpić podczas pracy, 
      a związanych z obsługą użytkownika, jak i błędów kodu. W ten sposób log serwera www 
      nie jest zaśmiecany. Aby włączyć wewnętrzny mechanizm logowania, należy w katalogu 
      <filename>data</filename> utworzyć plik tekstowy o nazwie <filename>errorlog</filename>,
      z prawem zapisu przez Bugzillę. Gdy wystąpią, wszelkie błędy będą zapisywane do tego pliku, 
      wraz z dodatkowymi informacjami, takimi jak: typ błędu, adres IP oraz login użytkownika 
      (jeśli jest dostępny), który wywołał wystąpienie błędu oraz wartości wszystkich zmiennych
      środowiskowych. W przypadku, gdy wysyłany był wypełniony formularz, zawartość wszystkich 
      pól także będzie dołączona. Aby wyłączyć logowanie, należy usunąć lub zmienić nazwę pliku
      <filename>errorlog</filename>.
    </para>
  </section>
        
  <section id="trbl-testserver">
  <title>Serwer Apache nie wyświetla stron Bugzilli</title>
    <para>Po dwukrotnym uruchomieniu skryptu <command>checksetup.pl</command>,
    uruchom skrypt <command>testserver.pl http://twojastrona.twojadomena/twójurl</command>,
    aby potwierdzić, że serwer www jest prawidłowo skonfigurowany do obsługi Bugzilli.
    </para>
    <programlisting>
<prompt>bash$</prompt> ./testserver.pl http://landfill.bugzilla.org/bugzilla-tip
TEST-OK Webserver is running under group id in $webservergroup.
TEST-OK Got ant picture.
TEST-OK Webserver is executing CGIs.
TEST-OK Webserver is preventing fetch of http://landfill.bugzilla.org/bugzilla-tip/localconfig.
</programlisting>
  </section>

  <section id="trbl-perlmodule">
  <title>Zainstalowano wymagany moduł Perl, ale skrypt 
      <filename>checksetup.pl</filename> twierdzi, że jest on niezainstalowany!</title>
      
    <para>Prawdopodobne przyczyny:</para>
    <orderedlist>
      <listitem>
        <para>Na twojej maszynie zainstalowane są dwie wersje Perla. Moduły są instalowane
        w jednej instalacji, a Bugzilla korzysta z innej. Należy ponownie
        uruchomić komendy CPAN (lub ręczną kompilację), używając pełnej ścieżki
        Perla przekazanej do skryptu <filename>checksetup.pl</filename>. W ten sposób
        będziemy mieli pewność, że moduły instalowane są we właściwym miejscu.
        </para>
      </listitem>
      <listitem>
        <para>Uprawnienia do katalogów z bibliotekami nie są właściwe. Muszą one być przynajmniej
        do odczytu przez użytkownika lub grupę serwera www. Zaleca się jednak, aby posiadały
        globalne uprawnienia do odczytu.
        </para>
      </listitem>
    </orderedlist>
  </section>

  <section id="trbl-dbdSponge">
  <title>DBD::Sponge::db prepare failed</title>
      
    <para>Następujący błąd może się pojawić w związku z błędem w DBD::mysql
    (nad którym zespół Bugzilli nie ma kontroli):
    </para>
      
<programlisting><![CDATA[ DBD::Sponge::db prepare failed: Cannot determine NUM_OF_FIELDS at D:/Perl/site/lib/DBD/mysql.pm line 248.
  SV = NULL(0x0) at 0x20fc444
  REFCNT = 1
  FLAGS = (PADBUSY,PADMY)
]]></programlisting>

    <para>W celu naprawy należy przejść do pliku 
    <filename>&lt;ścieżka-do-perl&gt;/lib/DBD/sponge.pm</filename> 
    lokalnej instalacji Perla i zastąpić wpis
    </para>
        
<programlisting><![CDATA[ my $numFields;
 if ($attribs->{'NUM_OF_FIELDS'}) {
     $numFields = $attribs->{'NUM_OF_FIELDS'};
 } elsif ($attribs->{'NAME'}) {
     $numFields = @{$attribs->{NAME}};
]]></programlisting>

    <para>wpisem</para>

<programlisting><![CDATA[ my $numFields;
 if ($attribs->{'NUM_OF_FIELDS'}) {
     $numFields = $attribs->{'NUM_OF_FIELDS'};
 } elsif ($attribs->{'NAMES'}) {
     $numFields = @{$attribs->{NAMES}};
]]></programlisting>

     <para>(uwaga na S dodane do NAME.)</para>
  </section>
    
  <section id="paranoid-security">
  <title>cannot chdir(/var/spool/mqueue)</title>

    <para>Jeśli Bugzilla jest instalowana w systemie SuSE Linux lub innej
    dystrybucji z <quote>paranoicznymi</quote> opcjami zabezpieczeń,
    to możliwe jest, że skrypt checksetup.pl może zakończyć pracę błędem: 
<programlisting><![CDATA[cannot chdir(/var/spool/mqueue): Permission denied
]]></programlisting>
    </para>
      
    <para>Spowodowane jest to tym, że katalog <filename>/var/spool/mqueue</filename>
    posiada ustawienia zabezpieczeń w postaci <computeroutput>drwx------</computeroutput>.
    Aby naprawić ten problem, należy wpisać w wierszu poleceń jako root <command>chmod 755 <filename>/var/spool/mqueue</filename></command>,
    co spowoduje nadanie uprawnienia do <emphasis>odczytu</emphasis> katalogu <filename>/var/spool/mqueue</filename>
    dla wszystkich procesów uruchomionych na lokalnej maszynie.
    </para>
  </section>    

  <section id="trbl-relogin-everyone">
  <title>Wszyscy są zmuszani do nieustannego logowania się</title>
  
  <para>Prawdopodobną przyczyną jest nieprawidłowa konfiguracja parametru <quote>cookiepath</quote>,
  którą można zmienić (jeśli posiada się uprawnienia administratora Bugzilli) na stronie editparams.cgi.
  </para>

  <para>Wartością parametru cookiepath powinien być katalog, w którym znajduje się
  instalacja Bugzilli, <emphasis>z punktu widzenia przeglądarki użytkownika.</emphasis>
  Początkowe i końcowe ukośniki są obowiązkowe. Parametrowi cookiepath można także
  przypisać dowolny katalog wyższego poziomu (np. '/', oznaczający katalog główny).
  Prawidłowe działanie ma miejsce tylko w przypadku przynajmniej częściowego dopasowania.
  Parametr ten ogranicza wysyłanie ciasteczek przez przeglądarkę użytkownika tylko 
  do określonego katalogu.
  </para>

  <para>Kiedy należy podać określony katalog Bugzilli, 
  a kiedy adres strony?
  </para>

  <para>Jeśli na danym serwerze uruchomiona jest pojedyncza instalacja Bugzilli,
  a pozostałym aplikacjom uruchomionym na tym samym serwerze udostępnia się
  jej ciasteczka (może to być celowy zabieg, jeśli pozostałe strony korzystają
  z systemu autentykacji Bugzilli), wtedy należy określić parametr cookiepath jako "/"
  lub podać odpowiednią ścieżkę do katalogu wyższego poziomu.
  </para>

  <example id="trbl-relogin-everyone-share">
  <title>Współdzielenie ciasteczek - przykłady par parametrów urlbase/cookiepath</title>

    <blockquote>
      <literallayout>
urlbase to http://bugzilla.mozilla.org/
cookiepath to /

urlbase to http://narzedzia.mojastrona.tld/bugzilla/
        jednak strona http://narzedzia.mojastrona.tld/innaaplikacja/ korzysta
        z mechanizmu autentykacji Bugzilli
cookiepath to /
      </literallayout>
    </blockquote>
  </example>

   <para>W przypadku, gdy na danym serwerze uruchomionych jest kilka instalacji
   Bugzilli (tak jak na naszym serwerze landfill), to należy tak określić
   wartość parametru cookiepath, aby poszczególne Bugzille potrafiły rozpoznać własne
   ciasteczka.
   </para>


   <example id="trbl-relogin-everyone-restrict">
   <title>Współdzielenie ciasteczek - przykłady par parametrów urlbase/cookiepath</title>
      <blockquote>
        <literallayout>
urlbase to http://landfill.bugzilla.org/bugzilla-tip/
cookiepath to /bugzilla-tip/

urlbase to http://landfill.bugzilla.org/bugzilla-4.0-branch/
cookiepath to /bugzilla-4.0-branch/
        </literallayout>
      </blockquote>
    </example>

    <para>Jeśli w przeszłości parametr cookiepath miał wartość <quote>/</quote>,
    a wystąpiła konieczność jego ograniczenia	
    (do np. <quote>/bugzilla/</quote>), to można dokonać tej zmiany bez konieczności
    usuwania ciasteczek Bugzilli przez użytkowników (jednak pod warunkiem
    korzystania z Bugzilli w wersji przynajmniej 2.18 lub 2.16.5).
    </para>
  </section>

  <section id="trbl-index">
  <title>Plik <filename>index.cgi</filename> nie jest wyświetlany, chyba że został bezpośrednio określony w adresie URL</title>
    <para>
      Należy skonfigurować serwer www w taki sposób, aby strona index.cgi
      była wyświetlana jako strona główna katalogu.
    </para>
    <para>
      W przypadku serwera Apache należy dodać wpis 
      <filename>index.cgi</filename> na końcu linii 
      <computeroutput>DirectoryIndex</computeroutput>, zgodnie z
      dokumentacją <xref linkend="http-apache"/>.
    </para>

  </section>

  <section id="trbl-passwd-encryption">
    <title>
      checksetup.pl zwraca błąd "Client does not support authentication protocol
      requested by server..."
    </title>

    <para>
      Wystąpienie tego błędu spowodowane jest korzystaniem z nowego
      mechanizmu szyfrowania haseł, który pojawił się w MySQL 4.1,
      jednak moduł <filename>DBD::mysql</filename> został skompilowany dla starszej wersji
      MySQL. Należy skompilować moduł <filename>DBD::mysql</filename>,
      używając nowszych wersji bibliotek (lub pobrać nowszą wersję modułu).
    </para>

    <para>
      Jeśli problem nie ustąpił i nie mamy możliwości skompilowania na nowo istniejącego
      modułu (np. korzystamy z systemu Windows) lub nie chcemy tego zrobić
      (np. chcemy zachować jego poprzednią wersję), to wtedy należy skorzystać z obejścia
      problemu opisanego w dokumentacji MySQL:
      <ulink url="http://dev.mysql.com/doc/mysql/en/Old_client.html"/>
    </para>

  </section>

</appendix> 

<!-- Keep this comment at the end of the file 
Local variables: 
mode: sgml 
sgml-always-quote-attributes:t
sgml-auto-insert-required-elements:t
sgml-balanced-tag-edit:t
sgml-exposed-tags:nil
sgml-general-insert-case:lower
sgml-indent-data:t 
sgml-indent-step:2 
sgml-local-catalogs:nil
sgml-local-ecat-files:nil 
sgml-minimize-attributes:nil
sgml-namecase-general:t 
sgml-omittag:t
sgml-parent-document:("Bugzilla-Guide.xml" "book" "chapter")
sgml-shorttag:t 
sgml-tag-region-if-active:t 
End: -->
