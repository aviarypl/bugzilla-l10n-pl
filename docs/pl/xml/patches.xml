<?xml version="1.0"?>
<!-- This Source Code Form is subject to the terms of the Mozilla Public
     License, v. 2.0. If a copy of the MPL was not distributed with this
     file, You can obtain one at http://mozilla.org/MPL/2.0/.

     This Source Code Form is "Incompatible With Secondary Licenses", as
     defined by the Mozilla Public License, v. 2.0.
-->
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
                      "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd" [
    <!ENTITY % myents SYSTEM "bugzilla.ent">
    %myents;
]>

<appendix id="patches" xreflabel="Useful Patches and Utilities for Bugzilla">
  <title>Katalog Contrib</title>

  <para>
    W katalogu
    <filename class="directory">$BUGZILLA_ROOT/contrib/</filename>
    znajdują się nieoficjalne dodatki do Bugzilli. Zostały one opisane w tym rozdziale.
  </para>

  <section id="cmdline">
    <title>Interfejs wyszukiwania z linii poleceń</title>

    <para>
      W katalogu <filename class="directory">contrib/cmdline</filename>
      znajduje się zestaw programów Uniksowych służących do wykonywania zapytań
      do bazy Bugzilli z linii poleceń. Składa się on z trzech plików -
      <filename>query.conf</filename>,
      <filename>buglist</filename> oraz <filename>bugs</filename>.
    </para>

    <warning>
      <para>
        Pliki te zostały udostępnione przed dodaniem obsługi szablonów wprowadzonej
        w Bugzilli 2.16 i od tamtej pory nie były aktualizowane.
      </para>
    </warning>
    
    <para>
      <filename>query.conf</filename> zawiera opcje, które są przyporządkowane
      oraz rodzajów porównywania. Modyfikacja pliku jest ułatwiona dzięki
      umieszczeniu opcji w cudzysłowie, co pozwala łatwo je wyszukać za
      pomocą polecenia grep. Komentarze (#) są pomijane, dlatego należy zwrócić szczególną uwagę,
      aby nie wyłączyć w ten sposób dostępnych <quote>opcji</quote>.
    </para>

    <para>
      <filename>buglist</filename> jest to skrypt powłoki shell, który wysyła zapytanie do
      instalacji Bugzilli i zapisuje stronę HTML z wynikami na standardowe wyjście.
      Obsługuje zarówno skrócone opcje wyszukiwania (np. <quote>-Afoo</quote>
      lub <quote>-Rbar</quote>) jak i długie (np.
      <quote>--assignedto=foo</quote> lub <quote>--reporter=bar</quote>).
      Jeśli pierwszym znakiem polecenia nie będzie znak <quote>-</quote> to polecenie
      jest traktowane jako poprzedzone opcją <quote>--default=</quote>.
    </para>

    <para>
      Lista kolumn pobierana jest ze zmiennej środowiskowej COLUMNLIST.
      Jest to odpowiednik polecenia <quote>Zmień kolumny</quote> dostępnego
      na liście błędów wyświetlonej przez stronę buglist.cgi. Jeśli korzystano już
      z Bugzilli, należy wyszukać w ciasteczku poleceniem grep wpis COLUMNLIST aby sprawdzić
      aktualne ustawienia parametru COLUMNLIST.
    </para>

    <para>
      <filename>bugs</filename> jest to skrypt powłoki shell, który wywołuje skrypt
      <filename>buglist</filename> i zapisuje numery błędów z zwróconych wyników
      wyszukiwania. Dodanie prefiksu
      <quote>http://bugzilla.mozilla.org/buglist.cgi?bug_id=</quote>
      zamieni listę wyników w gotowe odnośniki do poszczególnych błędów.
      Policzenie ilości występujących błędów jest dość proste. Wystarczy
      przekierować wyjście polecenia do <command>sed -e 's/,/ /g' | wc | awk '{printf $2 "\n"}'</command>
    </para>

    <para>
      Akkana Peck donosi, że bardzo dobre rezultaty można osiągnąć przekierowując
      wyjście skryptu <filename>buglist</filename> do polecenia 
      <command>w3m -T text/html -dump</command>
    </para>

  </section>

  <section id="cmdline-bugmail">
    <title>Narzędzie lini poleceń 'Send Unsent Bug-mail'</title>

    <para>
      W katalogu <filename class="directory">contrib</filename> można znaleźć 
      skrypt <filename>sendunsentbugmail.pl</filename>. 
      Jego zadaniem jest wysłanie oczekujących powiadomień błędów, 
      które z różnych powodów 
      nie zostały do tej pory wysłane.
    </para>

    <para>
      Aby wykonać to zadanie, skrypt <filename>sendunsentbugmail.pl</filename> wykorzystuje
      ten sam mechanizm działania co strona <filename>sanitycheck.cgi</filename>:
      skanowana jest cała baza danych w poszukiwaniu błędów, które zostały zmodyfikowane
      ponad 30 minut temu, ale nie istnieje zapis, że powiadomienia błędów zostały wysłane 
      do właściwych osób. Po skompletowaniu listy, wiadomości są wysyłane zgodnie
      z ustawieniami poczty 
      adresatów.
    </para>

    <para>
      Podczas pracy skrypt wyświetla numer przetwarzanego błędu, a po jej zakończeniu
      podsumowanie ilości wysłanych wiadomości oraz liczby osób, do których
      powiadomienia nie zostały wysłane (nazwy użytkowników nie są zapisywane
      czy wyświetlane). Jeśli skrypt po uruchomieniu nie wyświetla żadnych informacji, to oznacza 
      to, że nie wykryto niewysłanych wiadomości.
    </para>

    <para>
      <emphasis>Uruchomienie</emphasis>: przenieś skrypt sendunsentbugmail.pl
      do głównego katalogu, sprawdź czy posiada prawo wykonywania i uruchom z wiersza
      poleceń (lub za pomocą crona) bez podawania parametrów.
    </para>
  </section>

</appendix>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-always-quote-attributes:t
sgml-auto-insert-required-elements:t
sgml-balanced-tag-edit:t
sgml-exposed-tags:nil
sgml-general-insert-case:lower
sgml-indent-data:t
sgml-indent-step:2
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
sgml-minimize-attributes:nil
sgml-namecase-general:t
sgml-omittag:t
sgml-parent-document:("Bugzilla-Guide.xml" "book" "chapter")
sgml-shorttag:t
sgml-tag-region-if-active:t
End:
-->
