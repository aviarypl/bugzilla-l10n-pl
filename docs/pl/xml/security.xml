<?xml version="1.0"?>
<!-- This Source Code Form is subject to the terms of the Mozilla Public
     License, v. 2.0. If a copy of the MPL was not distributed with this
     file, You can obtain one at http://mozilla.org/MPL/2.0/.

     This Source Code Form is "Incompatible With Secondary Licenses", as
     defined by the Mozilla Public License, v. 2.0.
-->
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
                      "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd" [
    <!ENTITY % myents SYSTEM "bugzilla.ent">
    %myents;
]>

<chapter id="security">
<title>Zabezpieczanie instalacji Bugzilli</title>

  <para>Informacje zawarte w tym rozdziale mają na celu wskazanie praktyk
  zapewniających bezpieczeństwo danym gromadzonym w Bugzilli i dotyczą systemów 
  operacyjnych, na których jest ona uruchomiona oraz wykorzystywanego dodatkowego 
  oprogramowania. 

  Instrukcja ta nie jest kompletnym poradnikiem dotyczącym zabezpieczania
  instalacji Linuksa, Apache, MySQL lub innego wspomnianego w niej oprogramowania.
  Może to zapewnić tylko stały nadzór i monitorowanie danego serwera. Kluczem do 
  prawidłowego zabezpieczenia systemu jesteś... <emphasis>TY!</emphasis>
  </para>
  
  <para>Programiści z reguły przywiązują dużą wagę do pisania bezpiecznego kodu, jednak
  nigdy nie ma 100% pewności, że oprogramowanie nie jest pozbawione błędów związanych z
  bezpieczeństwem. Z tego powodu należy przyjąć założenie, że bezpieczny kod nie istnieje,
  dlatego środowisko, w którym się go użytkuje, należy dodatkowo zabezpieczyć poprzez ograniczenie
  uprawnień do pozostałych składników oprogramowania zainstalowanego na serwerze.
  </para>
 
  <section id="security-os">
  <title>System operacyjny</title>
  
    <section id="security-os-ports">
    <title>Porty TCP/IP</title>
    
      <!-- TODO: Get exact number of ports -->
      <para>Standard TCP/IP definiuje ponad 65000 portów przeznaczonych do
      wysyłania i odbierania ruchu sieciowego. Do działania Bugzilla potrzebuje tylko jednego
      (w przypadku innych konfiguracji i ustawień - do trzech). Zaleca się przeprowadzenie
      audytu otwartych portów, aby wyeliminować te zbędne. Dodatkowo sam serwer, na którym zainstalowana 
      jest Bugzilla (a także pozostałe serwery którymi administrujesz), 
      powinny znajdować się za firewallem.
      </para>
    
    </section>
    
    <section id="security-os-accounts">
    <title>Konta systemowe</title>
    
      <para>Zwykle <glossterm linkend="gloss-daemon">demony</glossterm>, takie jak
      <filename>httpd</filename> (Apache) lub 
      <filename>mysqld</filename> (MySQL), uruchamiane są z uprawnieniami użytkownika <quote>root</quote> lub
      <quote>nobody</quote>. Gorsza systuacja ma miejsce na maszynach pracujących pod kontrolą systemu Windows,
      gdzie większość 
      <glossterm linkend="gloss-service">usług</glossterm>
      jest uruchomionych jako użytkownik <quote>SYSTEM</quote>. 
      O ile niebezpieczeństwa związane z uruchamianiem ich jako <quote>root</quote> lub
      <quote>SYSTEM</quote> są powszechnie znane, to wykonywanie ich jako <quote>nobody</quote>
      już nie są takie oczywiste. Upraszczając, gdy demon jest uruchomiony jako <quote>nobody</quote>
      i zostanie on skompromitowany, to włamywacz otrzymuje dostęp do wszystkich usług uruchomionych jako
      <quote>nobody</quote>. Z tego powodu zaleca się stworzenie oddzielnego konta dla każdej z uruchamianych usług.
      </para>
    
      <note>
        <para>Należy skonfigurować opcję <option>webservergroup</option> w pliku
        <filename>localconfig</filename>, podając nazwę grupy, która ma zostać użyta do 
        uruchomienia serwera.
        Pozwoli to skryptowi <filename>./checksetup.pl</filename> ustawić odpowiednie
        wartości zabezpieczeń systemów typu Unix tak, aby pliki nie były globalnie do odczytu.
 
      </note>
    
    </section>
    
    <section id="security-os-chroot">
    <title>Instalacja w zamkniętym środowisku (metoda <filename>chroot</filename> jail)</title>
    
      <para>
        Jeśli wykorzystywany system operacyjny obsługuje tę metodę,	  
        to warto rozważyć instalację Bugzilli w izolowanym środowisku <filename>chroot</filename> jail.
        Dzięki temu znacząco zwiększy się bezpieczeństwo instalacji, gdyż
        dostęp do danych będzie ograniczony tylko do zasobów udostępnionych Bugzilli.
        Aby skonfigurować instalację, używając tej metody, należy zapoznać się z dokumentacją
        systemu operacyjnego.
      </para>
      
    </section>
  
  </section>

  <section id="security-webserver">
  <title>Serwer WWW</title>

    <section id="security-webserver-access">
    <title>Wyłączenie zdalnego dostępu do plików konfiguracyjnych Bugzilli</title>
    
      <para>
        Wiele plików znajdujących się w katalogu Bugzilli nie powinno być dostępnych
        do odczytu z poziomu serwera www. Lista kontrolna plików, których udostępnienie jest zalecane, a do których
        dostęp należy ograniczyć, jest bardzo skomplikowana. Szybkim sposobem na sprawdzenie
        poprawności instalacji jest uruchomienie skryptu <filename>testserver.pl</filename>
        lub przestrzeganie poniższych zaleceń. 
      </para>
      
      <tip>
        <para>Każde wydanie Bugzilli posiada wbudowaną funkcjonalność generowania plików
        <glossterm linkend="gloss-htaccess"><filename>.htaccess</filename></glossterm>,
        które wymuszają zastosowanie powyżej wspomnianych zasad. Instrukcje pozwalające na włączenie odpowiednich dyrektyw
        serwera Apache znajdują się w <xref linkend="http-apache"/>
        </para>
      </tip>
        
      <itemizedlist spacing="compact">
        <listitem>
          <para>W głównym katalogu Bugzilli należy:</para>
          <itemizedlist spacing="compact">
            <listitem>
              <para>Zablokować dostęp do plików:
              <simplelist type="inline">
                <member><filename>*.pl</filename></member>
                <member><filename>*localconfig*</filename></member>
              </simplelist>
              </para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para>W katalogu <filename class="directory">data</filename>:</para>
          <itemizedlist spacing="compact">
            <listitem>
              <para>Zablokować dostęp do wszystkich plików</para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para>W katalogu <filename class="directory">data/webdot</filename>:</para>
          <itemizedlist spacing="compact">
            <listitem>
              <para>Jeśli wykorzystywany jest zdalny serwer webdot:</para>
              <itemizedlist spacing="compact">
                <listitem>
                  <para>Zablokować dostęp do wszystkich plików</para>
                </listitem>
                <listitem>
                  <para>Poza
                  <simplelist type="inline">
                    <member><filename>*.dot</filename></member>
                  </simplelist>
                  dla zdalnego serwera webdot</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Jeśli wykorzystywany jest lokalny GraphViz:</para>
              <itemizedlist spacing="compact">
                <listitem>
                  <para>Zablokować dostęp do wszystkich plików</para>
                </listitem>
                <listitem>
                  <para>Poza
                  <simplelist type="inline">
                    <member><filename>*.png</filename></member>
                    <member><filename>*.gif</filename></member>
                    <member><filename>*.jpg</filename></member>
                    <member><filename>*.map</filename></member>
                  </simplelist>
                  </para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Jeśli nie korzystamy z narzędzi dot:</para>
              <itemizedlist spacing="compact">
                <listitem>
                  <para>Zablokować dostęp do wszystkich plików</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para>W katalogu <filename class="directory">Bugzilla</filename>:</para>
          <itemizedlist spacing="compact">
            <listitem>
              <para>Zablokować dostęp do wszystkich plików</para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para>W katalogu <filename class="directory">template</filename>:</para>
          <itemizedlist spacing="compact">
            <listitem>
              <para>Zablokować dostęp do wszystkich plików</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>

      <para>Należy upewnić się, że dostęp do danych został prawidłowo ograniczony
      poprzez przetestowanie instalacji. Szczególną uwagę należy zwrócić na zabezpieczenie pliku localconfig,
      który zawiera hasło do bazy danych. Warto pamiętać także o tym, że niektóre edytory tekstu
      tworzą pliki tymczasowe oraz kopie modyfikowanych plików, do których dostęp
      także powinien zostać ograniczony. Więcej informacji można znaleźć na stronie 
      <ulink url="http://bugzilla.mozilla.org/show_bug.cgi?id=186383">błędu 186383</ulink>
      lub
      <ulink url="http://online.securityfocus.com/bid/6501">Bugtraq ID 6501</ulink>.
      Aby przetestować instalację, należy uruchomić skrypt <filename>testserver.pl</filename>.
      </para>
      
      <tip>
        <para>Instrukcje dla pozostałych serwerów www 
        dostępne są na <xref linkend="http"/>.
        </para>
      </tip>
    
    </section>

      
  </section>
  
  
  <section id="security-bugzilla">
  <title>Bugzilla</title>

    <section id="security-bugzilla-charset">
    <title>Zabezpieczenie przed wstrzyknięciem złośliwego kodu Javascript przez użytkowników</title>

      <para>W Bugzilli w wersji 2.22 lub nowszej parametr
      <emphasis>utf8</emphasis> jest domyślnie włączony, zgodnie z
      <ulink
      url="http://www.cert.org/tech_tips/malicious_code_mitigation.html#3">
      zaleceniem wydanym przez organizację CERT</ulink>.
      W takim przypadku można zignorować poniższe uwagi, gdyż nie dotyczą one danej instalacji. 
      Parametr <emphasis>utf8</emphasis> powinno pozostawić się włączony.
      </para>

      <para>W przypadku, gdy dokonano aktualizacji ze starszej wersji
      możliwe jest wstrzyknięcie przez użytkownika Bugzilli złośliwego kodu, np. w postaci skryptów, do systemu komentarzy,
      gdyż parametr <emphasis>utf8</emphasis> nie jest włączany automatycznie.
      Ręczne włączenie parametru <emphasis>utf8</emphasis> pozwala zlikwidować powstałe zagrożenie bezpieczeństwa.
      </para>
    </section>    
    
  </section>

</chapter> 

<!-- Keep this comment at the end of the file 
Local variables: 
mode: sgml 
sgml-always-quote-attributes:t
sgml-auto-insert-required-elements:t
sgml-balanced-tag-edit:t
sgml-exposed-tags:nil
sgml-general-insert-case:lower
sgml-indent-data:t 
sgml-indent-step:2 
sgml-local-catalogs:nil
sgml-local-ecat-files:nil 
sgml-minimize-attributes:nil
sgml-namecase-general:t 
sgml-omittag:t
sgml-parent-document:("Bugzilla-Guide.xml" "book" "chapter")
sgml-shorttag:t 
sgml-tag-region-if-active:t 
End: -->
